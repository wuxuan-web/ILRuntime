# ILRuntime调试工作流程指南

## 正确的调试流程

### 第一步：启动扩展的调试VSCode

1. **在扩展开发VSCode中按 `F5`**
   - 这会启动一个新的VSCode窗口（扩展主机）
   - 新窗口会加载我们的ILRuntime扩展

2. **确认扩展已激活**
   - 在新窗口中打开输出面板（`Cmd+Shift+U`）
   - 选择 "ILRuntime Debug" 输出
   - 应该看到：`🚀 ILRuntime扩展激活中...`

### 第二步：在调试VSCode中打开ILRuntime热更文件

1. **打开Unity项目文件夹**
   - 在调试VSCode中：`File > Open Folder`
   - 选择你的Unity项目根目录
   - 或者打开包含热更新代码的文件夹

2. **打开热更新C#文件**
   - 导航到热更新代码文件（如 `HotfixAOT/TestHotfix.cs`）
   - 在代码中设置断点

### 第三步：启动Unity项目

1. **启动Unity项目**
   - 确保ILRuntime调试服务已启动
   - 查看Unity控制台是否有调试服务启动信息

2. **确认调试服务运行**
   - 端口56000应该被Unity占用
   - 可以通过 `netstat -an | grep 56000` 检查

### 第四步：开始调试

1. **在调试VSCode中启动调试**
   - 按 `F5` 或点击调试按钮
   - 选择 "Attach to ILRuntime (Unity)" 配置
   - 查看输出面板的调试信息

2. **触发断点**
   - 在Unity中执行会触发热更新代码的操作
   - 断点应该被命中

## 详细步骤说明

### 为什么需要两个VSCode窗口？

1. **扩展开发VSCode**（第一个窗口）
   - 用于开发和调试扩展本身
   - 按 `F5` 会启动扩展主机

2. **扩展主机VSCode**（第二个窗口）
   - 运行我们的ILRuntime扩展
   - 用于调试Unity的热更新代码

### 调试信息查看

#### 在扩展开发VSCode中：
- 查看扩展的激活日志
- 查看调试适配器启动信息
- 查看错误和警告

#### 在扩展主机VSCode中：
- 查看调试会话信息
- 查看断点命中情况
- 查看变量和调用栈

## 常见问题解决

### 问题1：扩展没有激活
**解决方案**：
- 检查 `package.json` 中的 `activationEvents`
- 确保在扩展主机VSCode中打开了正确的文件类型

### 问题2：找不到调试适配器
**解决方案**：
- 检查调试适配器是否已编译
- 查看扩展开发VSCode中的路径解析日志

### 问题3：无法连接到Unity
**解决方案**：
- 确保Unity项目正在运行
- 确保ILRuntime调试服务已启动
- 检查端口56000是否被占用

### 问题4：断点不工作
**解决方案**：
- 确保在正确的文件中设置断点
- 确保Unity中运行的是最新版本的热更新代码
- 检查代码路径是否匹配

## 调试技巧

### 1. 使用输出面板
- 扩展开发VSCode：查看扩展日志
- 扩展主机VSCode：查看调试会话日志

### 2. 使用调试控制台
- 在扩展主机VSCode中查看调试信息
- 执行调试命令

### 3. 使用断点
- 在热更新代码中设置断点
- 在扩展代码中设置断点（用于调试扩展本身）

### 4. 使用日志
- 查看Unity控制台输出
- 查看VSCode输出面板
- 查看调试适配器输出

## 快速检查清单

- [ ] 扩展开发VSCode中按F5启动扩展主机
- [ ] 扩展主机VSCode中打开Unity项目文件夹
- [ ] 扩展主机VSCode中打开热更新C#文件
- [ ] 在热更新代码中设置断点
- [ ] 启动Unity项目
- [ ] 确认ILRuntime调试服务已启动
- [ ] 在扩展主机VSCode中启动调试
- [ ] 选择正确的调试配置
- [ ] 在Unity中触发断点
- [ ] 验证断点被命中
